<launch>
	<arg name="model" default="$(env DRAGON_MODEL)"/>
	<arg name="mass" default="0.24"/>
	<arg name="use_vicon" default="true"/>

	<group ns="$(arg model)">

    <param name="mass" value="$(arg mass)"/>

	  <node pkg="mav_manager"
	    type="mav_services"
	    name="mav_services"
	    clear_params="true"
	    output="screen">
	    <rosparam file="$(find snavquad_interface)/config/mav_manager_params.yaml" />
	  </node>

		<node pkg="nodelet"
			type="nodelet"
			name="standalone_nodelet"
			args="manager"
			output="screen"/>

		<node pkg="nodelet"
			type="nodelet"
			name="trackers_manager"
			args="load trackers_manager/TrackersManager standalone_nodelet"
			clear_params="true"
			output="screen">
			<rosparam file="$(find snavquad_interface)/config/trackers.yaml"/>
   		<rosparam file="$(find snavquad_interface)/config/tracker_params.yaml"/>
    	<remap from="~odom" to="odom"/>
			<remap from="~cmd" to="position_cmd"/>
		</node>

		<group if="$(arg use_vicon)">
		  <node pkg="nodelet"
		    type="nodelet"
		    args="load so3_control/SO3TRPYControlNodelet standalone_nodelet"
		    name="trpy_control"
		    required="true"
		    output="screen">
		    <rosparam file="$(find snavquad_interface)/config/gains.yaml"/>
		    <param name="mass" value="$(arg mass)"/>
		    <remap from="~odom" to="odom"/>
		    <remap from="~position_cmd" to="position_cmd"/>
		    <remap from="~trpy_cmd" to="trpy_cmd"/>
		    <remap from="~motors" to="motors"/>
	  	</node>

		  <node pkg="nodelet"
		    type="nodelet"
		    name="snavquad_interface"
		    args="load snavquad_interface/TRPYCmdToSnav standalone_nodelet"
		    required="true"
		    clear_params="true"
		    output="screen">

		    <remap from="~odom" to="odom"/>
		    <remap from="~trpy_cmd" to="trpy_cmd"/>
		    <remap from="~imu" to="imu" />
		  </node>
		</group>

		<group unless="$(arg use_vicon)">

			<node pkg="snav_ros" type="pos_subscriber" name="pos_subscriber" output="screen"/>

			<!-- Node that publishes snav pose as odom -->
			<node pkg="snav_ros" type="vio_odom_publisher" name="vio_odom_publisher" output="screen"/>

    </group>

	</group>
</launch>
